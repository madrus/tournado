# Session Notes — 2025-09-04

These notes summarize today’s decisions and changes so you can resume tomorrow quickly.

## PRD Structure and Personas

- Primary personas: Admin, Manager, Referee, Public (order reflects priority).
- Referee promoted to primary; persona sections reordered accordingly.
- Clarified primary vs secondary (MVP-critical vs later).

## PRD Master vs Details

- Trimmed implementation detail from PRD master and moved to `docs/development/PRD.details.md`.
- Added HTML anchors in PRD.details and cross-linked from PRD master for one-click navigation.

## Roadmap Reordering

- Phase 1: Authentication — 1 week.
- Phase 2: Groups & Playoffs (MVP) — single-elimination only.
- Phase 3: Scheduling & Scoring.
- Phase 4: Public Engagement.
- Phase 5: Advanced Brackets.
- Durations normalized with short dashes (e.g., `3 - 4 weeks`).

## Mobile Wrapper

- Use Capacitor (not Cordova). Added plan in PRD.details and linked from PRD master.
- Added open question item earlier; retained final detailed plan under `#mobile-wrapper`.

## RBAC Model (PRD is source of truth)

- Admin: approves users and assigns roles (ADMIN/MANAGER); includes `users:approve`, `roles:assign`.
- Manager: full matches CRUD; manages groups; assigns referees; manages assignments; manages referee tokens (`refereeTokens:manage`). No general user role admin.
- Referee: no registered account; access via pre-auth, expiring, revocable links; scoped to assigned matches; no Admin Panel navigation beyond their own dashboard.
- Public: includes `teams:create` (public team registration).
- Deleted “Referee Coordinator” role; mapped duties to Manager.

## Artifacts Added

- RBAC hardening plan: `docs/development/RBAC.hardening.md` (tasks, acceptance criteria, test plan).
- Capacitor plan: `docs/development/PRD.details.md#mobile-wrapper`.
- Referee access model: `docs/development/PRD.details.md#referee-access-model`.
- Permissions glossary expanded: `docs/development/PRD.details.md#permissions-glossary`.

## Code vs PRD Gaps (to implement later)

- New permissions (`groups:manage`, `referees:assign`, `assignments:manage`, `refereeTokens:manage`, `users:approve`, `roles:assign`) not yet in `app/utils/rbac.ts`.
- Referee still permitted to Admin Panel in middleware/redirects; needs tightening to referee dashboard only.
- Referee scope (assigned-only) must be enforced in loaders/actions for score edits.

## Next Steps (when ready)

- Implement Phase 2 — RBAC Hardening per `docs/development/RBAC.hardening.md`.
- Add referee dashboard route and assignment checks.
- Add `RefereePreAuthToken` model and issuance/revocation flows.
- Update RBAC utilities, middleware, redirects, and tests.

---

Quick links:

- PRD master: `.cursor/rules/PRD.mdc`
- PRD details (anchors): `docs/development/PRD.details.md`
- RBAC plan: `docs/development/RBAC.hardening.md`
