generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id              String         @id @default(cuid())
  firstName       String
  lastName        String
  email           String         @unique
  firebaseUid     String         @unique
  displayName     String?
  role            Role
  active          Boolean        @default(true)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  performedAudits UserAuditLog[] @relation("PerformedAudits")
  auditLogs       UserAuditLog[] @relation("UserAuditLogs")

  @@index([active, createdAt])
}

model UserAuditLog {
  id            String   @id @default(cuid())
  userId        String
  performedBy   String
  action        String
  previousValue String?
  newValue      String?
  reason        String?
  createdAt     DateTime @default(now())
  admin         User     @relation("PerformedAudits", fields: [performedBy], references: [id])
  user          User     @relation("UserAuditLogs", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([performedBy])
  @@index([createdAt])
}

model TeamLeader {
  id        String   @id @default(cuid())
  firstName String
  lastName  String
  email     String   @unique
  phone     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  teams     Team[]
}

model Team {
  id           String     @id @default(cuid())
  name         String
  tournamentId String
  category     Category
  division     Division
  clubName     String
  teamLeaderId String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  groupSlot    GroupSlot? @relation("TeamGroupSlot")
  awayMatches  Match[]    @relation("Match_awayTeam")
  homeMatches  Match[]    @relation("Match_homeTeam")
  teamLeader   TeamLeader @relation(fields: [teamLeaderId], references: [id], onDelete: Cascade)
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
}

model Tournament {
  id          String       @id @default(cuid())
  name        String
  location    String
  divisions   String
  categories  String
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  groupStages GroupStage[]
  matches     Match[]
  teams       Team[]
}

model Match {
  id           String       @id @default(cuid())
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  date         DateTime
  time         DateTime
  location     String
  status       MatchStatus  @default(UPCOMING)
  tournamentId String
  homeTeamId   String
  awayTeamId   String
  awayTeam     Team         @relation("Match_awayTeam", fields: [awayTeamId], references: [id], onDelete: Cascade)
  homeTeam     Team         @relation("Match_homeTeam", fields: [homeTeamId], references: [id], onDelete: Cascade)
  tournament   Tournament   @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  scores       MatchScore[]
}

model MatchScore {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  matchId       String
  homeTeamScore Int
  awayTeamScore Int
  match         Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
}

model GroupStage {
  id           String      @id @default(cuid())
  tournamentId String
  name         String
  categories   String
  configGroups Int
  configSlots  Int
  autoFill     Boolean     @default(true)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  groups       Group[]
  groupSlots   GroupSlot[]
  tournament   Tournament  @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, name])
  @@index([tournamentId])
}

model Group {
  id           String      @id @default(cuid())
  groupStageId String
  name         String
  order        Int
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  groupStage   GroupStage  @relation(fields: [groupStageId], references: [id], onDelete: Cascade)
  slots        GroupSlot[]

  @@unique([groupStageId, name])
  @@unique([groupStageId, order])
  @@index([groupStageId])
}

model GroupSlot {
  id           String     @id @default(cuid())
  groupStageId String
  groupId      String?
  slotIndex    Int
  teamId       String?    @unique
  team         Team?      @relation("TeamGroupSlot", fields: [teamId], references: [id])
  group        Group?     @relation(fields: [groupId], references: [id])
  groupStage   GroupStage @relation(fields: [groupStageId], references: [id], onDelete: Cascade)

  @@unique([groupId, slotIndex])
  @@unique([groupStageId, teamId])
  @@index([groupStageId])
  @@index([teamId])
}

enum Role {
  ADMIN
  MANAGER
  EDITOR
  BILLING
  REFEREE
  PUBLIC
}

enum MatchStatus {
  UPCOMING
  PLAYED
  CANCELLED
  POSTPONED
}

enum Division {
  PREMIER_DIVISION
  FIRST_DIVISION
  SECOND_DIVISION
  THIRD_DIVISION
  FOURTH_DIVISION
  FIFTH_DIVISION
}

enum Category {
  JO8
  JO9
  JO10
  JO11
  JO12
  JO13
  JO14
  JO15
  JO16
  JO17
  JO19
  MO8
  MO9
  MO10
  MO11
  MO12
  MO13
  MO14
  MO15
  MO16
  MO17
  MO19
  VETERANEN_35_PLUS
  VETERANEN_40_PLUS
  VETERANEN_45_PLUS
  VETERANEN_50_PLUS
}
